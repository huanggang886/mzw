<?php global $zym_decrypt;$zym_decrypt['ÁÖ®ÖÀıÃÃÃ®ˆ¾ˆÖ¯ÃÃ¾¯ˆÄ®¥ÃıÖ¥”ıÄ']=base64_decode('ZGVmaW5lZA==');$zym_decrypt['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']=base64_decode('ZGFkZHNsYXNoZXM=');$zym_decrypt['ˆ¾ÖÄÖ”¯ÄÄ‹¥ÃÃÄÃÖıˆ¥Ä”ˆÄ®ÁÄ®‹”®ˆ']=base64_decode('Z2V0c2hvcA==');$zym_decrypt['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']=base64_decode('c3RycG9z');$zym_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']=base64_decode('ZXhwbG9kZQ==');$zym_decrypt['”¥Á¯Ä¾ÃÖÖıˆÖ®¯¯ÀÖÄıÃı¥”ÀÖÖıÖ”À']=base64_decode('bnVtYmVyX2Zvcm1hdA==');$zym_decrypt['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']=base64_decode('ZGF0ZQ==');$zym_decrypt['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹']=base64_decode('cmFuZA=='); ?>
<?php
if(!$GLOBALS['zym_decrypt']['ÁÖ®ÖÀıÃÃÃ®ˆ¾ˆÖ¯ÃÃ¾¯ˆÄ®¥ÃıÖ¥”ıÄ'](base64_decode('SU5fQ1JPTkxJVEU=')))exit();if($islogin==1){$act=isset($_GET['act'])?$_GET['act']:null;switch($act){case 'get': $type=isset($_GET['type'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['type']):exit('No paytype!');$orderid=isset($_GET['orderid'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['orderid']):exit('No orderid!');$qq=isset($_GET['qq'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['qq']):null;if($type=='wxpay'){require_once SYSTEM_ROOT."wxpay/WxPay.Api.php";$input =new WxPayOrderQuery();$input->SetOut_trade_no($orderid);$data=WxPayApi::orderQuery($input);if($data['return_code']=='SUCCESS' && $data['result_code']=='SUCCESS'){if($data['trade_state']=='SUCCESS'){$srow=$DB->get_row("SELECT * FROM ".DBQZ."_pay WHERE orderid='{$data['out_trade_no']}' limit 1");$sql="insert into `".DBQZ."_order` (`type`,`orderid`,`trade_no`,`time`,`name`,`money`,`status`) values ('wxpay','".$data['out_trade_no']."','".$data['transaction_id']."','".$date."','".$srow['name']."','".$srow['money']."','2')";$DB->query($sql);if($srow['status']==0){$DB->query("update `".DBQZ."_pay` set `status` ='1',`endtime` ='$date' where `orderid`='$orderid'");$GLOBALS['zym_decrypt']['ˆ¾ÖÄÖ”¯ÄÄ‹¥ÃÃÄÃÖıˆ¥Ä”ˆÄ®ÁÄ®‹”®ˆ']($srow['shopid'],$qq,$msg);exit(base64_decode('eyJjb2RlIjoxLCJtc2ciOiLku5jmrL7miJDlip8ifQ=='));}else{exit(base64_decode('eyJjb2RlIjoxLCJtc2ciOiLlt7Lnu4/otK3kubDov4cifQ=='));}}else{$msg='['.$data['trade_state'].']'.$data['trade_state_desc'];exit(base64_decode('eyJjb2RlIjotMSwibXNnIjoi').$msg.'"}');}}else{$msg='['.$data['err_code'].']'.$data['err_code_des'];exit(base64_decode('eyJjb2RlIjotMSwibXNnIjoi').$msg.'"}');}}elseif($GLOBALS['zym_decrypt']['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']($orderid,'shop')!==false){$data=$GLOBALS['zym_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']('_',$orderid);$userid=$data[1];$shopid=$data[2];$qq=$data[3];$money=$buy_rules[$shopid];$srow=$DB->get_row("SELECT * FROM ".DBQZ."_order WHERE name='{$orderid}' order by time desc limit 1");if($srow['status']==1){if($GLOBALS['zym_decrypt']['”¥Á¯Ä¾ÃÖÖıˆÖ®¯¯ÀÖÄıÃı¥”ÀÖÖıÖ”À']($money,2)!= $GLOBALS['zym_decrypt']['”¥Á¯Ä¾ÃÖÖıˆÖ®¯¯ÀÖÄıÃı¥”ÀÖÖıÖ”À']($srow['money'],2))exit('{"code":-1,"msg":"ä»˜æ¬¾é‡‘é¢ä¸å•†å“ä»·æ ¼ä¸ç¬¦"}');$orderid=$GLOBALS['zym_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("YmdHis").$GLOBALS['zym_decrypt']['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹'](111,999);$sql="insert into `".DBQZ."_pay` (`uid`,`qq`,`type`,`orderid`,`addtime`,`endtime`,`shopid`,`money`,`status`) values ('".$uid."','".$qq."','".$type."','".$orderid."','".$date."','".$date."','".$shopid."','".$money."','1')";$DB->query($sql);$DB->query("update `".DBQZ."_order` set `status` ='2',`orderid` ='$orderid' where `trade_no`='{$srow['trade_no']}'");$msg ='OK';$GLOBALS['zym_decrypt']['ˆ¾ÖÄÖ”¯ÄÄ‹¥ÃÃÄÃÖıˆ¥Ä”ˆÄ®ÁÄ®‹”®ˆ']($shopid,$qq,$msg);exit(base64_decode('eyJjb2RlIjoxLCJtc2ciOiLku5jmrL7miJDlip8ifQ=='));}elseif($srow['status']==2){exit('{"code":1,"msg":"å·²ç»è´­ä¹°è¿‡"}');}else{exit(base64_decode('eyJjb2RlIjotMSwibXNnIjoi5pyq5LuY5qy+In0='));}}else{$row=$DB->get_row("SELECT * FROM ".DBQZ."_pay WHERE orderid='{$orderid}' limit 1");if($row['status']==1){exit('{"code":1,"msg":"ä»˜æ¬¾æˆåŠŸ"}');}else{exit(base64_decode('eyJjb2RlIjotMSwibXNnIjoi5pyq5LuY5qy+In0='));}}break;case base64_decode('ZmlsbA=='): $type=isset($_GET['type'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['type']):exit('No paytype!');$orderid=isset($_GET['orderid'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['orderid']):exit('No orderid!');$shopid=isset($_GET['shopid'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['shopid']):exit('No shopid!');$qq=isset($_GET['qq'])?$GLOBALS['zym_decrypt']['ıÄÀÁ”ÁÀÀÄ‹¥À‹®Ö®ÁÀı‹”ˆ¾ÁÀ®ÄÄÃˆ']($_GET['qq']):null;$money=$buy_rules[$shopid];$srow=$DB->get_row("SELECT * FROM ".DBQZ."_order WHERE trade_no='{$orderid}' limit 1");if($srow['status']==1){if($GLOBALS['zym_decrypt']['”¥Á¯Ä¾ÃÖÖıˆÖ®¯¯ÀÖÄıÃı¥”ÀÖÖıÖ”À']($money,2)!= $GLOBALS['zym_decrypt']['”¥Á¯Ä¾ÃÖÖıˆÖ®¯¯ÀÖÄıÃı¥”ÀÖÖıÖ”À']($srow['money'],2))exit('{"code":-1,"msg":"ä»˜æ¬¾é‡‘é¢ä¸å•†å“ä»·æ ¼ä¸ç¬¦"}');$orderid=$GLOBALS['zym_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("YmdHis").$GLOBALS['zym_decrypt']['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹'](111,999);$sql="insert into `".DBQZ."_pay` (`uid`,`qq`,`type`,`orderid`,`addtime`,`endtime`,`shopid`,`money`,`status`) values ('".$uid."','".$srow['qq']."','".$type."','".$orderid."','".$date."','".$date."','".$shopid."','".$money."','1')";$DB->query($sql);$DB->query("update `".DBQZ."_order` set `status` ='2',`orderid` ='$orderid' where `trade_no`='{$srow['trade_no']}'");$msg ='OK';$GLOBALS['zym_decrypt']['ˆ¾ÖÄÖ”¯ÄÄ‹¥ÃÃÄÃÖıˆ¥Ä”ˆÄ®ÁÄ®‹”®ˆ']($shopid,$qq,$msg);exit(base64_decode('eyJjb2RlIjoxLCJtc2ciOiLku5jmrL7miJDlip8ifQ=='));}elseif($srow['status']==2){exit('{"code":2,"msg":"è¯¥äº¤æ˜“å·å·²ç»æˆåŠŸè´­ä¹°è¿‡ï¼Œè¯·è¿”å›åˆ·æ–°æŸ¥çœ‹"}');}else{exit(base64_decode('eyJjb2RlIjotMSwibXNnIjoi5Lqk5piT5Y+35LiN5a2Y5ZyoIn0='));}break;}}else{exit(base64_decode('eyJjb2RlIjotMywibXNnIjoi55m75b2V5aSx6LSl77yM5Y+v6IO95piv5a+G56CB6ZSZ6K+v5oiW6ICF6Lqr5Lu95aSx5pWI5LqG77yM6K+36YeN5paw55m75b2V77yBIn0='));}