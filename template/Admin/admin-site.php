<?php global $zym_decrypt;$zym_decrypt['֮î֯þĮ֥']=base64_decode('ZGVmaW5lZA==');$zym_decrypt['֮įþĔ']=base64_decode('ZGF0ZQ==');$zym_decrypt['֯֎ֈĎ']=base64_decode('aW50dmFs');$zym_decrypt['֯ÈËå֋þ']=base64_decode('c2hvd21zZw==');$zym_decrypt['ċľ־Ôî֔Ď']=base64_decode('ZXhwbG9kZQ==');$zym_decrypt['Ĉĥ־Î']=base64_decode('ZmlsZV9nZXRfY29udGVudHM=');$zym_decrypt['îîþå']=base64_decode('c3RyX3JlcGxhY2U=');$zym_decrypt['֯֎֮ľ֋î']=base64_decode('Y291bnQ=');$zym_decrypt['îî']=base64_decode('c2F2ZVNldHRpbmc=');$zym_decrypt['Ôֈֈ']=base64_decode('cmFuZG9t'); ?>
<?php
if(!$GLOBALS['zym_decrypt']['֮î֯þĮ֥'](base64_decode('SU5fQ1JPTkxJVEU=')))exit();$title="分站管理";$breadcrumb='<li><a href="index.php?mod=user"><i class="icon fa fa-home"></i>首页</a></li>
<li><a href="index.php?mod=admin"><i class="icon fa fa-cog"></i>后台管理</a></li>
<li class="active"><a href="#"><i class="icon fa fa-list-alt"></i>分站管理</a></li>';include TEMPLATE_ROOT.base64_decode('aGVhZC5waHA=');echo base64_decode('PGRpdiBjbGFzcz0iY29sLW1kLTEyIiByb2xlPSJtYWluIj4=');$my=isset($_GET['my'])?$_GET['my']:null;if ($isadmin==1 && $is_fenzhan==0){$date=$GLOBALS['zym_decrypt']['֮įþĔ']("Y-m-d");if($my==null){$numrows=$DB->count("select count(*) from ".DBQZ."_site where 1");$outdate=$DB->count("select count(*) from ".DBQZ."_site where date<$date");echo base64_decode('PGgzPuWIhuermeeuoeeQhjwvaDM+');echo base64_decode('PGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtaW5mbyI+57O757uf5YWx5pyJ').$numrows.'个分站，其中过期的分站有'.$outdate.'个。<br/>
<a href="index.php?mod=admin-site&my=add" class="btn btn-primary">添加一个分站</a>';echo base64_decode('PC9kaXY+');$pagesize=$conf['pagesize'];$pages=$GLOBALS['zym_decrypt']['֯֎ֈĎ']($numrows/$pagesize);if ($numrows%$pagesize){$pages++;}if (isset($_GET['page'])){$page=$GLOBALS['zym_decrypt']['֯֎ֈĎ']($_GET['page']);}else{$page=1;}$offset=$pagesize*($page - 1);?>

<style>
.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tfoot>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>thead>tr>th{white-space: pre-wrap;}
</style>
<div class="panel panel-default table-responsive">
<table class="table table-hover">
	<thead>
		<tr>
			<th>数据表前缀</th>
			<th>绑定域名</th>
			<th>到期时间</th>
			<th>状态</th>
			<th>操作</th>
		</tr>
	</thead>
	<tobdy>
<?php
 $rs=$DB->query("select * from ".DBQZ."_site where 1 order by id desc limit $offset,$pagesize");$i=0;while($myrow =$DB->fetch($rs)){$i++;$pagesl =$i + ($page - 1)* $pagesize;echo base64_decode('PHRyIGlkPSI=').$myrow['id'].'"><td style="width:15%;"><b>'.$myrow['db'].'</b></td><td style="width:30%">'.$myrow['url'].'</td><td style="width:20%">'.$myrow['date'].'</td><td style="width:10%">'.($myrow['active']==1?'开启':'关闭').'</td><td style="width:25%">';echo base64_decode('PGEgaHJlZj0iaW5kZXgucGhwP21vZD1hZG1pbi1zaXRlJm15PWVkaXQmaWQ9').$myrow['id'].$link.'" class="btn btn-info btn-xs">编辑</a>&nbsp;<a href="index.php?mod=admin-site&my=delete&id='.$myrow['id'].$link.'" class="btn btn-danger btn-xs">删除</a></td></tr>';}?>
	</tbody>
</table>
</div>

<?php
echo base64_decode('PHVsIGNsYXNzPSJwYWdpbmF0aW9uIj4=');$first=1;$prev=$page-1;$next=$page+1;$last=$pages;if ($page>1){echo '<li><a href="index.php?mod=admin-site&page='.$first.$link.'">首页</a></li>';echo base64_decode('PGxpPjxhIGhyZWY9ImluZGV4LnBocD9tb2Q9YWRtaW4tc2l0ZSZwYWdlPQ==').$prev.$link.'">&laquo;</a></li>';}else {echo base64_decode('PGxpIGNsYXNzPSJkaXNhYmxlZCI+PGE+6aaW6aG1PC9hPjwvbGk+');echo base64_decode('PGxpIGNsYXNzPSJkaXNhYmxlZCI+PGE+JmxhcXVvOzwvYT48L2xpPg==');}for ($i=1;$i<$page;$i++)echo '<li><a href="index.php?mod=admin-site&page='.$i.$link.'">'.$i .'</a></li>';echo base64_decode('PGxpIGNsYXNzPSJkaXNhYmxlZCI+PGE+').$page.'</a></li>';for ($i=$page+1;$i<=$pages;$i++)echo '<li><a href="index.php?mod=admin-site&page='.$i.$link.'">'.$i .'</a></li>';echo '';if ($page<$pages){echo '<li><a href="index.php?mod=admin-site&page='.$next.$link.'">&raquo;</a></li>';echo base64_decode('PGxpPjxhIGhyZWY9ImluZGV4LnBocD9tb2Q9YWRtaW4tc2l0ZSZwYWdlPQ==').$last.$link.'">尾页</a></li>';}else {echo base64_decode('PGxpIGNsYXNzPSJkaXNhYmxlZCI+PGE+JnJhcXVvOzwvYT48L2xpPg==');echo base64_decode('PGxpIGNsYXNzPSJkaXNhYmxlZCI+PGE+5bC+6aG1PC9hPjwvbGk+');}echo base64_decode('PC91bD4=');}elseif($my=='add'){echo '<div class="panel panel-primary">
<div class="panel-heading"><h3 class="panel-title">添加分站</h3></div>';echo base64_decode('PGRpdiBjbGFzcz0icGFuZWwtYm9keSI+');echo base64_decode('PGZvcm0gYWN0aW9uPSJpbmRleC5waHA/bW9kPWFkbWluLXNpdGUmbXk9YWRkX3N1Ym1pdCIgbWV0aG9kPSJQT1NUIj4KPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CjxsYWJlbD4q5pWw5o2u6KGo5YmN57yAKOWPquiDveS4uuWwj+WGmeiLseaWh++8jOS4lOS4jeiDvei2hei/hzbkuKrlrZfoioIpOjwvbGFiZWw+PGJyPgo8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0iZGJxeiIgdmFsdWU9IiIgcGxhY2Vob2xkZXI9Indqb2IiIHJlcXVpcmVkPgo8L2Rpdj4KPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CjxsYWJlbD4q57uR5a6a5Z+f5ZCNOjwvbGFiZWw+PGJyPgo8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0idXJsIiB2YWx1ZT0iIiByZXF1aXJlZD4KPGZvbnQgY29sb3I9ImdyZWVuIj7nu5HlrprlpJrkuKrln5/lkI3or7fnlKjoi7HmlofpgJflj7cs6ZqU5byA77yBPC9mb250Pgo8L2Rpdj4KPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CjxsYWJlbD4q6L+H5pyf5pe26Ze0OjwvbGFiZWw+PGJyPgo8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImQxMSIgY2xhc3M9ImZvcm0tY29udHJvbCBXZGF0ZSIgbmFtZT0iZGF0ZSIgdmFsdWU9IiIgb25DbGljaz0iV2RhdGVQaWNrZXIoe2lzU2hvd0NsZWFyOmZhbHNlfSkiIGF1dG9jb21wbGV0ZT0ib2ZmIiByZXF1aXJlZD4KPC9kaXY+CjxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgo8bGFiZWw+KuaYr+WQpuWFgeiuuOabtOaUuUFQSeiuvue9rjo8L2xhYmVsPjxicj48c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wiIG5hbWU9ImFwaSI+PG9wdGlvbiB2YWx1ZT0iMSI+MV/mmK88L29wdGlvbj48b3B0aW9uIHZhbHVlPSIwIj4wX+WQpjwvb3B0aW9uPjwvc2VsZWN0Pgo8L2Rpdj4KPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CjxsYWJlbD4q5piv5ZCm5r+A5rS7OjwvbGFiZWw+PGJyPjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0iYWN0aXZlIj48b3B0aW9uIHZhbHVlPSIxIj4xX+a/gOa0uzwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjAiPjBf5bCB56aBPC9vcHRpb24+PC9zZWxlY3Q+CjwvZGl2Pgo8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KPGxhYmVsPirmmK/lkKblhpnlhaXmlbDmja7ooag6PC9sYWJlbD48YnI+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIiBuYW1lPSJmb3JjZSI+PG9wdGlvbiB2YWx1ZT0iMSI+MV/mmK8o5paw5bu65YiG56uZKTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjAiPjBf5ZCmKOaBouWkjeW3suacieWIhuermSk8L29wdGlvbj48L3NlbGVjdD4KPC9kaXY+CjxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgo8bGFiZWw+5aSH5rOo5L+h5oGvOjwvbGFiZWw+PGJyPgo8dGV4dGFyZWEgY2xhc3M9ImZvcm0tY29udHJvbCIgbmFtZT0ibm90ZSIgcm93cz0iMyIgcGxhY2Vob2xkZXI9IuS7heeUqOS6juWkh+azqCI+PC90ZXh0YXJlYT4KPC9kaXY+CjxpbnB1dCB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLWJsb2NrIgp2YWx1ZT0i56Gu5a6a5re75YqgIj48L2Zvcm0+');echo base64_decode('PGJyLz48YSBocmVmPSJpbmRleC5waHA/bW9kPWFkbWluLXNpdGUiPj4+6L+U5Zue5YiG56uZ566h55CGPC9hPg==');echo base64_decode('PC9kaXY+PC9kaXY+');}elseif($my=='edit'){$id=$_GET['id'];$row=$DB->get_row("select * from ".DBQZ."_site where id='$id' limit 1");echo base64_decode('PGRpdiBjbGFzcz0icGFuZWwgcGFuZWwtcHJpbWFyeSI+CjxkaXYgY2xhc3M9InBhbmVsLWhlYWRpbmciPjxoMyBjbGFzcz0icGFuZWwtdGl0bGUiPuS/ruaUueWIhuermeS/oeaBrzwvaDM+PC9kaXY+');echo base64_decode('PGRpdiBjbGFzcz0icGFuZWwtYm9keSI+');echo base64_decode('PGZvcm0gYWN0aW9uPSJpbmRleC5waHA/bW9kPWFkbWluLXNpdGUmbXk9ZWRpdF9zdWJtaXQmaWQ9').$id.'" method="POST">
<div class="form-group">
<label>*数据表前缀(只能为小写英文，且不能超过6个字节):</label><br>
<input type="text" class="form-control" name="dbqz" value="'.$row['db'].'" disabled="disabled" required>
</div>
<div class="form-group">
<label>*绑定域名:</label><br>
<input type="text" class="form-control" name="url" value="'.$row['url'].'" required>
<font color="green">绑定多个域名请用英文逗号,隔开！</font>
</div>
<div class="form-group">
<label>*过期时间:</label><br>
<input type="text" id="d11" class="form-control Wdate" name="date" value="'.$row['date'].'" onClick="WdatePicker({isShowClear:false})" autocomplete="off" required>
</div>
<div class="form-group">
<label>*是否允许更改API设置:</label><br><select class="form-control" name="api" default="'.$row['api'].'"><option value="1">1_是</option><option value="0">0_否</option></select>
</div>
<div class="form-group">
<label>*是否激活:</label><br><select class="form-control" name="active" default="'.$row['active'].'"><option value="1">1_激活</option><option value="0">0_封禁</option></select>
</div>
<div class="form-group">
<label>备注信息:</label><br>
<textarea class="form-control" name="note" rows="3" placeholder="仅用于备注">'.$row['note'].'</textarea>
</div>
<input type="submit" class="btn btn-primary btn-block"
value="确定修改"></form>
';echo base64_decode('PGJyLz48YSBocmVmPSJpbmRleC5waHA/bW9kPWFkbWluLXNpdGUiPj4+6L+U5Zue5YiG56uZ566h55CGPC9hPg==');echo base64_decode('PC9kaXY+PC9kaXY+CjxzY3JpcHQ+CnZhciBpdGVtcyA9ICQoInNlbGVjdFtkZWZhdWx0XSIpOwpmb3IgKGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKCSQoaXRlbXNbaV0pLnZhbCgkKGl0ZW1zW2ldKS5hdHRyKCJkZWZhdWx0IikpOwp9Cjwvc2NyaXB0Pg==');}elseif($my=='add_submit'){$dbqz=$_POST['dbqz'];$url=$_POST['url'];$date=$_POST['date'];$api=$_POST['api'];$active=$_POST['active'];$note=$_POST['note'];$drop=$_POST['drop'];if($dbqz==NULL or $url==NULL or $date==NULL){$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('保存错误,请确保加*项都不为空!',3);}else {$siterow=$DB->get_row("select * from ".DBQZ."_site where db='$dbqz' limit 1");if($siterow['url']||$dbqz==DBQZ)$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('新增分站失败！数据表前缀已被使用。',3);$sqls="insert into `".DBQZ."_site` (`db`,`url`,`date`,`api`,`active`,`note`) values ('".$dbqz."','".$url."','".$date."','".$api."','".$active."','".$note."')";$urls=$GLOBALS['zym_decrypt']['ċľ־Ôî֔Ď'](',',$url);foreach($urls as $row){if($row==$_SERVER['HTTP_HOST'])$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('不能将主站域名绑定到分站!',3);$DB->query("REPLACE INTO ".DBQZ."_domain SET db='$dbqz',domain='$row'");}if($_POST['force']==1){$sql=$GLOBALS['zym_decrypt']['Ĉĥ־Î'](ROOT."install/install.sql");$sql=$GLOBALS['zym_decrypt']['îîþå']('{DBQZ}', $dbqz, $sql);$sql=$GLOBALS['zym_decrypt']['ċľ־Ôî֔Ď'](';</explode>',$sql);$t=0;$e=0;$error='';for($i=0;$i<$GLOBALS['zym_decrypt']['֯֎֮ľ֋î']($sql);$i++){if ($sql[$i]=='')continue;if($DB->query($sql[$i])){++$t;}else {++$e;$error.=$DB->error().'<br/>';}}$GLOBALS['zym_decrypt']['îî'](base64_decode('YnVpbGQ='),$GLOBALS['zym_decrypt']['֮įþĔ'](base64_decode('WS1tLWQgSDppOnM=')),$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('c3lza2V5'),$GLOBALS['zym_decrypt']['Ôֈֈ'](32),$dbqz);if($api==0){$GLOBALS['zym_decrypt']['îî']('qqlevelapi', $qqlevelapi,$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('YXBpc2VydmVy'), $conf['apiserver'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXFhcGlpZA=='), $conf['qqapiid'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXFsb2dpbmlk'), $conf['qqloginid'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('bWFpbF9hcGk='), $conf['mail_api'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('bXpqY19hcGk='), $conf['mzjc_api'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('bXlxcWFwaQ=='), $conf['myqqapi'],$dbqz);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXF6X2FwaQ=='), $conf['qqz_api'],$dbqz);}}if($DB->query($sqls)&& $e==0){showmsg('新增分站成功！SQL成功'.$t.'句/失败'.$e.'句。<br/><font color=red>注：分站首个注册的用户即为管理员，请分站站长尽快注册账号。</font><br/>请将该分站的域名解析到本站服务器，并添加授权，即可访问。<br/><br/><a href="index.php?mod=admin-site">>>返回分站管理</a>',1);}else $GLOBALS['zym_decrypt']['֯ÈËå֋þ'](base64_decode('5paw5aKe5YiG56uZ5aSx6LSl77yBU1FM5oiQ5Yqf').$t.'句/失败'.$e.'句<br/>错误信息：'.$error.$DB->error(),4);}}elseif($my=='edit_submit'){$id=$_GET['id'];$rows=$DB->get_row("select * from ".DBQZ."_site where id='$id' limit 1");if(!$rows)$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('当前记录不存在！',3);$url=$_POST['url'];$date=$_POST['date'];$api=$_POST['api'];$active=$_POST['active'];$note=$_POST['note'];if($url==NULL or $date==NULL){$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('保存错误,请确保加*项都不为空!',3);}else {if($api==0){$GLOBALS['zym_decrypt']['îî']('qqlevelapi', $qqlevelapi,$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('YXBpc2VydmVy'), $conf['apiserver'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXFhcGlpZA=='), $conf['qqapiid'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXFsb2dpbmlk'), $conf['qqloginid'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('bWFpbF9hcGk='), $conf['mail_api'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('bXpqY19hcGk='), $conf['mzjc_api'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('bXlxcWFwaQ=='), $conf['myqqapi'],$rows['db']);$GLOBALS['zym_decrypt']['îî'](base64_decode('cXF6X2FwaQ=='), $conf['qqz_api'],$rows['db']);}$sql="update `".DBQZ."_site` set `url` ='$url',`date` ='$date',`api` ='$api',`active` ='$active',`note` ='$note' where `id`='$id'";$urls=$GLOBALS['zym_decrypt']['ċľ־Ôî֔Ď'](',',$url);foreach($urls as $row)$DB->query("REPLACE INTO ".DBQZ."_domain SET db='{$rows['db']}',domain='$row'");if($DB->query($sql))showmsg('修改分站成功！<br/><br/><a href="index.php?mod=admin-site">>>返回分站管理</a>',1);else $GLOBALS['zym_decrypt']['֯ÈËå֋þ'](base64_decode('5L+u5pS55YiG56uZ5aSx6LSl77yB').$DB->error(),4);}}elseif($my=='delete'){$id=$_GET['id'];$rows=$DB->get_row("select * from ".DBQZ."_site where id='$id' limit 1");if(!$rows)$GLOBALS['zym_decrypt']['֯ÈËå֋þ']('当前记录不存在！',3);$urls=$GLOBALS['zym_decrypt']['ċľ־Ôî֔Ď'](',',$rows['url']);foreach($urls as $row)$DB->query("DELETE FROM ".DBQZ."_domain WHERE db='{$rows['db']}'");$sql="DELETE FROM ".DBQZ."_site WHERE id='$id'";if($DB->query($sql))showmsg('删除分站成功！<br/>此操作并没有删除该分站对应的数据表，如需删除请到数据库中删除。<br/><br/><a href="index.php?mod=admin-site">>>返回分站管理</a>',1);else $GLOBALS['zym_decrypt']['֯ÈËå֋þ'](base64_decode('5Yig6Zmk5YiG56uZ5aSx6LSl77yB').$DB->error(),4);}}else {$GLOBALS['zym_decrypt']['֯ÈËå֋þ'](base64_decode('5ZCO5Y+w566h55CG55m75b2V5aSx6LSl44CC6K+35Lul566h55CG5ZGY6Lqr5Lu9IDxhIGhyZWY9ImluZGV4LnBocD9tb2Q9bG9naW4iPumHjeaWsOeZu+W9lTwvYT7vvIE='),3);}include TEMPLATE_ROOT.base64_decode('Zm9vdC5waHA=');?>